#!/usr/bin/env groovy

pipeline {

    agent any

    parameters {
        choice(name: 'SERVICE', choices: ['Buslogic', 'Origination'], description: 'Select a service to deploy')
        choice(name: 'COUNTRY', choices: ['Ke', 'Ug', 'Zm'], description: 'Select a country to deploy to')
    }

//    tools {
//        jdk 'Coretto 17'
//    }

    options {
        disableConcurrentBuilds(abortPrevious: true)
        skipStagesAfterUnstable()
    }

    environment {
//        PROJECT_VERSION = "${readProperties(file: "${WORKSPACE}/gradle.properties").version}"
        PROJECT_VERSION = "6.0.1"
        TASK = "deploy${params.SERVICE}${params.COUNTRY}"
    }

    stages {

        stage('Build') {
            steps {
                echo ">>> Build version: ${env.PROJECT_VERSION} on branch: ${env.BRANCH_NAME}"
            }
			script {
				try {
					sh 'chmod +x gradlew'
					sh './gradlew build'
				} finally {
					junit '**/build/test-results/test/*.xml'
					archive includes: '**/build/test-results/test/*.xml'
				}
			}
			archive includes: 'build/reports/changelog/**'
        }

    }
}